#!/usr/bin/env node
function cli(t){var r={help:{format:"",description:"Displays this information."},format:{format:"<format>",description:"Indicate which format to use for output."},"list-rules":{format:"",description:"Outputs all of the rules available."},quiet:{format:"",description:"Only output when errors are present."},errors:{format:"<rule[,rule]+>",description:"Indicate which rules to include as errors."},warnings:{format:"<rule[,rule]+>",description:"Indicate which rules to include as warnings."},ignore:{format:"<rule[,rule]+>",description:"Indicate which rules to ignore completely."},"exclude-list":{format:"<file|dir[,file|dir]+>",description:"Indicate which files/directories to exclude from being linted."},version:{format:"",description:"Outputs the current version number."}};function i(r,i){var n,e=t.readFile(r),o=function(t){var r=t.ignore,i=null;return r&&(i=CSSLint.getRuleset(),r.split(",").forEach(function(t){i[t]=0})),i}(i),s=CSSLint.verify(e,function(t,r){var i=t.rules||t.warnings,n=t.errors;return i&&(r=r||{},i.split(",").forEach(function(t){r[t]=1})),n&&(r=r||{},n.split(",").forEach(function(t){r[t]=2})),r}(i,o)),a=CSSLint.getFormatter(i.format||"text"),c=s.messages||[],u=0;return e?(i.fullPath=t.getFullPath(r),(n=a.formatResults(s,r,i))&&t.print(n),c.length>0&&function(t,r){return t.filter(function(t){return t.type===r})}(c,"error").length>0&&(u=1)):(a.readError?t.print(a.readError(r,"Could not read file data. Is the file empty?")):t.print("csslint: Could not read file data in "+r+". Is the file empty?"),u=1),u}function n(){var i="",n="";for(var e in t.print(["\nUsage: csslint-rhino.js [options]* [file|dir]*"," ","Global Options"].join("\n")),r)r.hasOwnProperty(e)&&(i+="  --"+e,""!==r[e].format?i+=n="="+r[e].format:n="",i+=new Array(40-(e.length+n.length)).join(" "),i+=r[e].description+"\n");t.print(i)}function e(r,i){for(var n,e,o=r.shift(),s=[];o;)0===o.indexOf("--")?(n=o.substring(2)).indexOf("=")>-1?i[(e=n.split("="))[0]]=e[1]:i[n]=!0:t.isDirectory(o)?s=s.concat(t.getFiles(o)):s.push(o),o=r.shift();return i.files=s,i}var o=t.args,s=o.length,a={};((a=e(o,a=function(r){var i=t.readFile(t.getFullPath(".csslintrc"));return i&&(r=e(i.split(/[\s\n\r]+/m),r)),r}(a))).help||0===s)&&(n(),t.quit(0)),function(i){for(var e in i)r.hasOwnProperty(e)||"files"===e||(t.print(e+" is not a valid option. Exiting..."),n(),t.quit(0))}(a),a.version&&(t.print("v"+CSSLint.version),t.quit(0)),a["list-rules"]&&(t.print(""),CSSLint.getRules().forEach(function(r){t.print(r.id+"\n  "+r.desc+"\n")}),t.quit(0)),t.quit(function(r,n){var e,o,s=0,a=n.format||"text",c=function(r,i){var n,e=i["exclude-list"],o=[],s=r.map(t.getFullPath);return e&&(e.split(",").forEach(function(r){t.isDirectory(r)?o=o.concat(t.getFiles(r)):o.push(r)}),o.forEach(function(r){n=t.getFullPath(r),s.indexOf(n)>-1&&s.splice(s.indexOf(n),1)})),s}(r,n);return c.length?CSSLint.hasFormat(a)?((o=(e=CSSLint.getFormatter(a)).startFormat())&&t.print(o),c.forEach(function(t){0===s?s=i(t,n):i(t,n)}),(o=e.endFormat())&&t.print(o)):(t.print("csslint: Unknown format '"+a+"'. Cannot proceed."),s=1):(t.print("csslint: No files specified."),s=1),s}(a.files,a))}var fs=require("fs"),path=require("path"),CSSLint=require("./lib/csslint-node").CSSLint;cli({args:process.argv.slice(2),print:function(t){fs.writeSync(1,t+"\n")},quit:function(t){process.exit(t||0)},isDirectory:function(t){try{return fs.statSync(t).isDirectory()}catch(t){return!1}},getFiles:function(t){var r=[];try{fs.statSync(t)}catch(t){return[]}return function t(i,n){n.push(i),fs.readdirSync(n.join("/")).forEach(function(i){var e=n.concat([i]).join("/"),o=fs.statSync(e);"."!=i[0]&&(o.isFile()&&/\.css$/.test(i)?r.push(e):o.isDirectory()&&t(i,n))}),n.pop()}(t,[]),r},getWorkingDirectory:function(){return process.cwd()},getFullPath:function(t){return path.resolve(process.cwd(),t)},readFile:function(t){try{return fs.readFileSync(t,"utf-8")}catch(t){return""}}});