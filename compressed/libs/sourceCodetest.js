const fs=require("fs"),path=require("path"),glob=require("glob"),htmlCheck=require("./htmlTest"),cssCheck=require("./cssTest");var htmlCheckOptions,cssCheckOptions,jsCheckOptions,htmlList,cssList,jsList,checkOptions=require("../common/checkConfig");function souceCode(o,s){checkOptionsValid(o,s),getFileList(o),s.checkHtml&&checkHtml(),s.checkCss&&checkCss()}function checkCss(){console.log(""),console.log(""),console.info("/***************开始CSS检查********************/");let o=cssCheck(cssList,checkOptions);o?(console.log(""),console.warn(`共发现${o}个错误`),console.log("")):(console.log(""),console.info(`共发现${o}个错误`),console.log("")),console.info("/***************CSS检查结束********************/")}function checkHtml(){console.log(""),console.log(""),console.info("/***************开始HTML检查********************/");let o=htmlCheck(htmlList,checkOptions);o?(console.log(""),console.warn(`共发现${o}个错误`),console.log("")):(console.log(""),console.info(`共发现${o}个错误`),console.log("")),console.info("/***************HTML检查结束********************/")}function getFileList(o){htmlList=glob.sync("**/*.html"),cssList=glob.sync("**/*.css")}function checkOptionsValid(o,s){if(s.optionsPath&&fs.existsSync(s.optionsPath)){console.log(""),console.info("/***************发现自定义检查配置********************/");let c=require(path.join(o,s.optionsPath));if(s.checkHtml&&void 0===c.htmlCheckOptions)throw new Error("配置文件缺少htmlCheckOptions配置项");if(s.checkCss&&void 0===c.cssCheckOptions)throw new Error("配置文件缺少cssCheckOptions配置项");c.errorLogPath||(console.info("配置文件缺少errorLogPath配置项,使用默认路径./errorLog作为日志路径"),c.errorLogPath="./errorLog"),checkOptions=c}else console.info("/******************使用默认配置********************/");checkOptions.errorLogPath=path.join(o,checkOptions.errorLogPath),htmlCheckOptions=checkOptions.htmlCheckOptions,cssCheckOptions=checkOptions.cssCheckOptions}module.exports=souceCode;